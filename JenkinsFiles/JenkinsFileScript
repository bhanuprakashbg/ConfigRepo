properties = null

def loadProperties() {
	node {
		checkout scm
		properties = new Properties()		
		File propertiesFile = new File("${workspace}/Properties/pipeline.properties")
		properties.load(propertiesFile.newDataInputStream())    
		echo "Immediate one ${properties.appPath}"
	}
}

def notify(status){
	emailext(
		to: "bhanuprakash.bg@gmail.com",
		subject: "${status}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'",
		body: """<p>${status}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' :</p>
		<p>Check console output at <a href='${env.BUILD_URL}'>${env.JOB_NAME} [${env.BUILD_NUMBER}]</a></p>""",

		)
	}


node('master'){
		
	try {
		notify('Project Build Started')

		stage ('Load Properties') {
			script {
				loadProperties()				
			}
		}
		
		script {
			git "${properties.JenkinsFile}"
			sh 'pwd'
			dir('utilities') {
				def java = load "utilities/java/javaJenkinsFile.groovy"
				java.javastage()
			}			
			sh 'ls -ltr'
		}
		
		script {
			def common = load "utilities/java/commonFile.groovy"
			sh 'pwd'
			common.commonstage() 
			sh 'ls -ltr'
		}
		
		notify('Project Build Completed')					
		
	} catch(err) {
		notify("Error ${err}")
		currentBuild.result='FAILURE'
	}
		
}
