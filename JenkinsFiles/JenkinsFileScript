properties = null  

def loadProperties() {
    node {
        checkout scm
        properties = new Properties()		
        File propertiesFile = new File("${workspace}/Properties/pipeline.properties")
        properties.load(propertiesFile.newDataInputStream())    
	echo "Immediate one ${properties.appPath}"
    }
}

def notify(status){
    emailext(
        to: "bhanuprakash.bg@gmail.com",
        subject: "${status}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'",
        body: """<p>${status}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' :</p>
        <p>Check console output at <a href='${env.BUILD_URL}'>${env.JOB_NAME} [${env.BUILD_NUMBER}]</a></p>""",
        
        )
}

node('master'){
	
	try {
		notify('Project Build Started')

		stage ('Load Properties') {
			script {
				loadProperties()				
			}
		}

		stage('Checkout') {
			git "${properties.appPath}"
			
			
			dir('Utilities') {
				git "${properties.JenkinsFile}"
			}
			sh 'pwd'
		}	

		
	} catch(err) {
		notify("Error ${err}")
		currentBuild.result='FAILURE'
	}
	
}


